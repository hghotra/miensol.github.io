<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.60c3ca86afa5e5c4da02.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}blockquote{background:#ededed;border-left:8px solid #5d93ff;box-shadow:0 3px 15px rgba(0,0,0,.15);color:#222;font-size:1.1em;font-style:italic;font-weight:300;line-height:1.6;margin:0;padding:1.2em;position:relative;vertical-align:super;z-index:0;overflow:hidden;text-align:start}blockquote:before{color:#5d93ff;content:"\201C";font-size:5em;left:0;position:absolute;top:-35px}blockquote p:before{color:#ddd;content:"\201C";font-size:50em;line-height:.65em;right:.095em;position:absolute;z-index:-1}blockquote span{color:#5d93ff;display:block;font-size:1.4em;font-weight:300;letter-spacing:.0625rem;margin-top:.5em}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism{color:#222}.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-contact--8_j8F{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.21.9"/><link rel="alternate" type="application/rss+xml" title="Piotr Mionskowski" href="/feed.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-49294874-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-49294874-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><title data-react-helmet="true">How to deploy Lambda function with CloudFormation? - Piotr Mionskowski</title><meta data-react-helmet="true" name="description" content="Serverless deployments are popular these days. With a minimal cost you can have your own code wait and respond to various events. AWS Lambda, Azure Functions are just 2 examples of serverless offering from the biggest cloud providers. For a long time I had thought about them only in the context of ad-hoc setups not…"/><meta data-react-helmet="true" property="og:site_name" content="How to deploy Lambda function with CloudFormation? - Piotr Mionskowski"/><meta data-react-helmet="true" property="og:image" content="https://miensol.pl//[object Object]"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="How to deploy Lambda function with CloudFormation? - Piotr Mionskowski"/><meta data-react-helmet="true" name="twitter:description" content="Serverless deployments are popular these days. With a minimal cost you can have your own code wait and respond to various events. AWS Lambda, Azure Functions are just 2 examples of serverless offering from the biggest cloud providers. For a long time I had thought about them only in the context of ad-hoc setups not…"/><meta data-react-helmet="true" name="twitter:image" content="https://miensol.pl//[object Object]"/><link as="script" rel="preload" href="/webpack-runtime-81078feff732a01ca8b6.js"/><link as="script" rel="preload" href="/framework-ff21b39501fa5007c91d.js"/><link as="script" rel="preload" href="/532a2f07-5faf1395916999ba184f.js"/><link as="script" rel="preload" href="/app-6174af72088d24da11e8.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/c39ba592b6b5047a9857340a927d4f5e647ac87b-a4bdae0c130dc607cbb4.js"/><link as="script" rel="preload" href="/70ba16277e1f8ff187315c677a20c57a8b12f94a-076ebef65155af783aeb.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js"/><link as="fetch" rel="preload" href="/page-data/deploy-lambda-with-cloudformation/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">How to deploy Lambda function with CloudFormation?</h1><div class="Content-module--content__body--2TrQ-"><p>Serverless deployments are popular these days. With a minimal cost you can have your own code wait and respond to various events. AWS Lambda, Azure Functions are just 2 examples of serverless offering from the biggest cloud providers. For a long time I had thought about them only in the context of ad-hoc setups not suitable for a long term development. This was until I found out that you can, with a little effort, version and deploy the serverless API just as a traditional back-end. In this post I am going to show how to deploy AWS Lambda functions with the help of the tool <a href="https://adambar.pl/" target="_blank" rel="nofollow noopener noreferrer">Adam</a> created at <a href="https://brightinventions.pl/" target="_blank" rel="nofollow noopener noreferrer">Bright Inventions</a> called <a href="https://github.com/bright/cloudform" target="_blank" rel="nofollow noopener noreferrer">cloudform</a>.</p>
<p><img src="..//images/lambda/lambda.png" alt="Lambda function"></p>
<h2 id="step-1-define-a-template" style="position:relative;"><a href="#step-1-define-a-template" aria-label="step 1 define a template permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 1: Define a template</h2>
<p>Let’s install the <a href="https://github.com/bright/cloudform" target="_blank" rel="nofollow noopener noreferrer">cloudform</a> <code class="language-text">npm i --save-dev cloudform</code> and define a minimal template:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> cloudform<span class="token punctuation">,</span> <span class="token punctuation">{</span> Lambda<span class="token punctuation">,</span> <span class="token constant">IAM</span><span class="token punctuation">,</span> Fn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cloudform'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> LambdaExecutionRole <span class="token operator">=</span> <span class="token string">'LambdaExecutionRole'</span><span class="token punctuation">;</span>

<span class="token function">cloudform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    Resources<span class="token operator">:</span> <span class="token punctuation">{</span>
        HelloWorld<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lambda<span class="token punctuation">.</span>Function</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            Code<span class="token operator">:</span> <span class="token punctuation">{</span>
                ZipFile<span class="token operator">:</span> <span class="token string">"exports.wrtiteToConsole = function (event, context, callback){ console.log('Hello'); callback(null); }"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Handler<span class="token operator">:</span> <span class="token string">"index.wrtiteToConsole"</span><span class="token punctuation">,</span>
            Role<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>LambdaExecutionRole<span class="token punctuation">,</span> <span class="token string">"Arn"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Runtime<span class="token operator">:</span> <span class="token string">"nodejs6.10"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>LambdaExecutionRole<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">IAM<span class="token punctuation">.</span>Role</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            AssumeRolePolicyDocument<span class="token operator">:</span> <span class="token punctuation">{</span>
                Statement<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    Effect<span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
                    Principal<span class="token operator">:</span> <span class="token punctuation">{</span> Service<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lambda.amazonaws.com"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    Action<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"sts:AssumeRole"</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Path<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
            ManagedPolicyArns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>There are only 2 resources defined in the template.  <code class="language-text">HelloWorld</code> is the AWS Lambda function definition. We have set the <code class="language-text">Runtime</code> property to use <code class="language-text">nodejs6.10</code> hence the <code class="language-text">Code.ZipFile</code> contains a JavaScript code. Despite the name <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-lambda-function-code.html#cfn-lambda-function-code-zipfile" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">ZipFile</code></a> should contain application source code in plain text. Obviously the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-lambda-function-code.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">ZipFile</code></a> may only be used for the most simple functions. The <code class="language-text">S3Bucket</code> and <code class="language-text">S3Key</code> properties can be used to deploy a more involved function implementation. The <code class="language-text">Handler</code> defines which function from <code class="language-text">Code</code> the Lambda runtime should invoke. In case of <code class="language-text">ZipFile</code> the first part is always <code class="language-text">index</code>. </p>
<p>The <code class="language-text">Role</code> is a required setting for every AWS Lambda function. It defines what entitlements the code invoked by the Lambda runtime has. In the above template we define a policy which can be assumed by <code class="language-text">lambda.amazonaws.com</code> and references a pre-defined AWS managed policy <a href="https://docs.aws.amazon.com/lambda/latest/dg/intro-permission-model.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">AWSLambdaBasicExecutionRole</code></a>. The <code class="language-text">AWSLambdaBasicExecutionRole</code> makes it possible for the Lambda function logs to be pushed to Cloud Watch.</p>
<h2 id="step-2-create-the-aws-lambda-function" style="position:relative;"><a href="#step-2-create-the-aws-lambda-function" aria-label="step 2 create the aws lambda function permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 2: Create the AWS Lambda function</h2>
<p>Deploying our Lambda function using CloudFormation requires a single command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">aws cloudformation create-stack <span class="token punctuation">\</span>
    --capabilities CAPABILITY_IAM <span class="token punctuation">\</span>
    --stack-name lambda-example <span class="token punctuation">\</span>
    --template-body file://<span class="token operator">&lt;</span><span class="token punctuation">(</span>node_modules/.bin/cloudform aws-template.ts<span class="token punctuation">)</span></code></pre></div>
<p>The <code class="language-text">--capabilities CAPABILITY_IAM</code> is required whenever the CloudFormation has to define Roles, Policies or related resources. The <code class="language-text">--template-body file://&lt;(node_modules/.bin/cloudform aws-template.ts)</code> instructs CloudFormation to use a template defined in a file. The <code class="language-text">&lt;(...)</code> is <a href="https://superuser.com/questions/1059781/what-exactly-is-in-bash-and-in-zsh" target="_blank" rel="nofollow noopener noreferrer">bash and zsh way to pass an output of a command</a> to other program as if the output was a file. After waiting a bit for the invocation to complete we will see the following in the AWS Console:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/db231600f8b624947a1b37ee4784ae95/ca3c3/aws-console.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 78.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACl0lEQVQ4y4VUW3LbMAzkoXurHqA/vUD75ZkmcWzHSSRZb4miqAcl6rEFqKj1R6blzJoUCILAYmnxfDrj6fiM0/mCXw+PeHh6QikrRHECzw8gK4UkTREniVtLpVBWlZvbrkNZlkilRnX4BvX1C4RSNa7XV4RRBGMM+r6HGQaM4+gw0Nrhz9r8tX347XbTdxAcoKIbm6YB1hXLsmxBewM7Wkx22kBrO62YF2Chn2VZHezIe5sPr4Wqa/jBjTKM0VGgmQI2ukFRSoyDxWxnd2CZgTL08fr8iJOf4vQW4PgaINfG+czjdqngILptXbC26zFNkwtoKdgyLZszYaHsFPF2vFzw/ccBh4uPo58g04Pz231FXWukRLq1FvvQZDMdcWWIn36g8okrguwsPDXikjW4lgZRM6LQxtHDPj0lJGqtkeU5NGXFBPPo2g5N3UKWFSqpoKoaStbQSmMaRirPYrULzt6BqMkhSRUcI8tyiKZpnSz4Y8+Sy95L/QzTuM3czKIoSTqVu1TXDURL2XB07uw+5ml2HP4L3KiaMk7iDHlaoNUtlWy4y5oES6WRHlk63BymIc+L/yDfspOSMpTgSlnoIi8KvJCw397eEWUlejM4gZs7AbvvHSxgJ/TN3t/vEQRvcrkMS+JcP8TNYE6Zz3sbY55n18CJVU5jvbO7gHGSOmGz0718mAa2s40FP37s8eFbGCFMqWx6y7s6eAguqabXwh3jd12RePl7XzM/LKkNGi09gobAa3eOfHhdEHWS+BQdEckfXhjD8zyHIAic2D3vHXEc0YGaAmnqYofOoXVz3+/o3b8OZyv4No6sWkNlhO55cRYp6fLnWdJ7LXF9iXC5xgjJFlGHo7zELc3gJxVuiaTZR5zGKGjvNyOVyhJWZID3AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/db231600f8b624947a1b37ee4784ae95/8ac56/aws-console.webp 240w,
/static/db231600f8b624947a1b37ee4784ae95/d3be9/aws-console.webp 480w,
/static/db231600f8b624947a1b37ee4784ae95/e46b2/aws-console.webp 960w,
/static/db231600f8b624947a1b37ee4784ae95/f992d/aws-console.webp 1440w,
/static/db231600f8b624947a1b37ee4784ae95/62ac3/aws-console.webp 1850w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/webp"
        />
        <source
          srcset="/static/db231600f8b624947a1b37ee4784ae95/8ff5a/aws-console.png 240w,
/static/db231600f8b624947a1b37ee4784ae95/e85cb/aws-console.png 480w,
/static/db231600f8b624947a1b37ee4784ae95/d9199/aws-console.png 960w,
/static/db231600f8b624947a1b37ee4784ae95/07a9c/aws-console.png 1440w,
/static/db231600f8b624947a1b37ee4784ae95/ca3c3/aws-console.png 1850w"
          sizes="(max-width: 960px) 100vw, 960px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/db231600f8b624947a1b37ee4784ae95/d9199/aws-console.png"
          alt="AWS Lambda Screen"
          title="AWS Lambda Screen"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<p>It is possible to use the AWS Console editor to test and change the function. However, if we are to treat the serverless approach seriously we should not forget about the standard practices like versioning of our source code.</p>
<h2 id="step-3-update-and-version-aws-lambda-function" style="position:relative;"><a href="#step-3-update-and-version-aws-lambda-function" aria-label="step 3 update and version aws lambda function permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step 3: Update and version AWS Lambda function</h2>
<p>Since we have defined the AWS Lambda function using a cloudform template we can version it as any other code. The whole serverless infrastructure we use and configure is treated as a source code allowing for an easy replication of deployment environments, audit trail and change management. Let’s see how we can use cloudform to add another function that will be called by the first one.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> cloudform<span class="token punctuation">,</span> <span class="token punctuation">{</span> Lambda<span class="token punctuation">,</span> <span class="token constant">IAM</span><span class="token punctuation">,</span> Fn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cloudform'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FunctionProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cloudform/types/lambda/function'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> readFileSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span>
    LambdaExecutionRole <span class="token operator">=</span> <span class="token string">'LambdaExecutionRole'</span><span class="token punctuation">,</span>
    Alice <span class="token operator">=</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span>
    Bob <span class="token operator">=</span> <span class="token string">'Bob'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">lambdaFunction</span><span class="token punctuation">(</span>
    <span class="token parameter">functionCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    options<span class="token operator">?</span><span class="token operator">:</span> Partial<span class="token operator">&lt;</span>FunctionProperties<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Lambda<span class="token punctuation">.</span>Function</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        Code<span class="token operator">:</span> <span class="token punctuation">{</span> ZipFile<span class="token operator">:</span> functionCode <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Handler<span class="token operator">:</span> <span class="token string">"index.main"</span><span class="token punctuation">,</span>
        Role<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>LambdaExecutionRole<span class="token punctuation">,</span> <span class="token string">"Arn"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Runtime<span class="token operator">:</span> <span class="token string">"nodejs6.10"</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>options
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">cloudform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    Resources<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>Alice<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">lambdaFunction</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'Alice.js'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            Environment<span class="token operator">:</span> <span class="token punctuation">{</span>
                Variables<span class="token operator">:</span> <span class="token punctuation">{</span>
                    BobFunction<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>Bob<span class="token punctuation">,</span> <span class="token string">"Arn"</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>Bob<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">lambdaFunction</span><span class="token punctuation">(</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'Bob.js'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">...</span> <span class="token comment">// LambdaExecutionRole see below</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>As you can see above, we’ve extracted a function <code class="language-text">lambdaFunction</code> to simplify Lambda function declaration. Both <code class="language-text">Alice</code> and <code class="language-text">Bob</code> function’s bodies are defined in separate files. Interestingly  <code class="language-text">Alice</code> function, during the invocation, will have access to <code class="language-text">BobFunction</code> environment variable pointing to <code class="language-text">Bob</code> function <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html" target="_blank" rel="nofollow noopener noreferrer">ARN</a>.</p>
<p>Our <code class="language-text">LambdaExecutionRole</code> lacks a permission to invoke another Lambda function. Let’s fix that:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">    <span class="token punctuation">[</span>LambdaExecutionRole<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">IAM<span class="token punctuation">.</span>Role</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        AssumeRolePolicyDocument<span class="token operator">:</span> <span class="token punctuation">{</span>
            Statement<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                Effect<span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
                Principal<span class="token operator">:</span> <span class="token punctuation">{</span> Service<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lambda.amazonaws.com"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                Action<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"sts:AssumeRole"</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        Path<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
        ManagedPolicyArns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        Policies<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            PolicyName<span class="token operator">:</span> <span class="token string">"AllowCallingOtherLambda"</span><span class="token punctuation">,</span>
            PolicyDocument<span class="token operator">:</span> <span class="token punctuation">{</span>
                Version<span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
                Statement<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    Sid<span class="token operator">:</span> <span class="token string">"InvokeLambdaPermission"</span><span class="token punctuation">,</span>
                    Effect<span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
                    Action<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lambda:InvokeFunction"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    Resource<span class="token operator">:</span> <span class="token string">"*"</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>The <code class="language-text">Alice</code> and <code class="language-text">Bob</code> sources export <code class="language-text">main</code> functions invoked by AWS Lambda runtime:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// Alice.ts</span>
<span class="token keyword">import</span> aws <span class="token keyword">from</span> <span class="token string">'aws-sdk'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> context<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> <span class="token builtin">Function</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">aws<span class="token punctuation">.</span>Lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        FunctionName<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>BobFunction<span class="token operator">!</span><span class="token punctuation">,</span>
        Payload<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">"Hi!. I'm Alice."</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token operator">:</span> Error<span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FromBob'</span><span class="token punctuation">,</span> error <span class="token operator">||</span> response<span class="token punctuation">)</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Bob.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> context<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> callback<span class="token operator">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'FromAlice'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>message<span class="token operator">:</span> <span class="token string">"Hi! I'm Bob. Nice to meet you!"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Since we now use TypeScript for <code class="language-text">Alice</code> and <code class="language-text">Bob</code> source we need to install the compiler <code class="language-text">npm i --save-dev typescript @types/node aws-sdk</code>. Unfortunately currently in <a href="https://github.com/bright/cloudform" target="_blank" rel="nofollow noopener noreferrer">cloudform</a> it is not possible to use custom <code class="language-text">tsconfig.json</code> for the compilation. Fortunately we can invoke the compiler manually and use its outputs as any other Node.js source code. With a <code class="language-text">tsconfig.json</code>:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es6"</span><span class="token punctuation">,</span>
    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token property">"strictPropertyInitialization"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"compileOnSave"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span></code></pre></div>
<p>we can use the following commands to compile and deploy Lambda functions:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">./node_modules/.bin/tsc

aws cloudformation update-stack <span class="token punctuation">\</span>
    --capabilities CAPABILITY_IAM <span class="token punctuation">\</span>
    --stack-name lambda-example <span class="token punctuation">\</span>
    --template-body file://<span class="token operator">&lt;</span><span class="token punctuation">(</span>node -e <span class="token string">"console.log<span class="token variable"><span class="token punctuation">((</span>require<span class="token punctuation">(</span>'.<span class="token operator">/</span>aws<span class="token operator">-</span>template'<span class="token punctuation">)</span>.default<span class="token punctuation">))</span></span>"</span><span class="token punctuation">)</span></code></pre></div>
<p>After the stack update completes we now should have 2 Lambda functions available. When we invoke the <code class="language-text">Alice</code> function, we’ll see that the 2 AWS Lambda functions communicate:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">START RequestId: 6a87c764-251e-11e8-b921-f9ca7649c7d7 Version: $LATEST
2018-03-11T11:22:00.615Z	6a87c764-251e-11e8-b921-f9ca7649c7d7	Alice says: Hi!. I&#39;m Alice.
2018-03-11T11:22:01.676Z	6a87c764-251e-11e8-b921-f9ca7649c7d7	Bob says: Hi! I&#39;m Bob. Nice to meet you!
END RequestId: 6a87c764-251e-11e8-b921-f9ca7649c7d7
REPORT RequestId: 6a87c764-251e-11e8-b921-f9ca7649c7d7	Duration: 1110.68 ms	Billed Duration: 1200 ms 	Memory Size: 128 MB	Max Memory Used: 34 MB	</code></pre></div>
<p>Serverless infrastructure offers endless possibilities. With <a href="https://github.com/bright/cloudform" target="_blank" rel="nofollow noopener noreferrer">cloudform</a> we can take AWS Lambda development, change management and deployment to the next level.</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->11 Mar 2018</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/aws/">aws</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cloudformation/">cloudformation</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/lambda/">lambda</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cloudform/">cloudform</a></li></ul></div><div class="Author-module--author--2Yefr"><p>TDD fan eager to learn new things. Always focused, always eager to ask why?<a class="Author-module--author__bio-contact--8_j8F" href="mailto:piotr.mionskowski@gmail.com" rel="noopener noreferrer" target="_blank"><strong>Piotr Mionskowski</strong></a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/deploy-lambda-with-cloudformation/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-6174af72088d24da11e8.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-78521276b246725d0e0f.js"],"component---src-templates-categories-list-template-tsx":["/component---src-templates-categories-list-template-tsx-1443a27db8e607e06eaf.js"],"component---src-templates-category-template-tsx":["/component---src-templates-category-template-tsx-9b2527fed1bbc12d167a.js"],"component---src-templates-index-template-tsx":["/component---src-templates-index-template-tsx-90ea64a37c4d7b280402.js"],"component---src-templates-not-found-template-tsx":["/component---src-templates-not-found-template-tsx-3d89186c897c9782220b.js"],"component---src-templates-page-template-tsx":["/component---src-templates-page-template-tsx-daedb109729ccd084ce5.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js"],"component---src-templates-tag-template-tsx":["/component---src-templates-tag-template-tsx-0485877a475bb21e2d32.js"],"component---src-templates-tags-list-template-tsx":["/component---src-templates-tags-list-template-tsx-82656016ea107e26a0f3.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js" async=""></script><script src="/70ba16277e1f8ff187315c677a20c57a8b12f94a-076ebef65155af783aeb.js" async=""></script><script src="/c39ba592b6b5047a9857340a927d4f5e647ac87b-a4bdae0c130dc607cbb4.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-6174af72088d24da11e8.js" async=""></script><script src="/532a2f07-5faf1395916999ba184f.js" async=""></script><script src="/framework-ff21b39501fa5007c91d.js" async=""></script><script src="/webpack-runtime-81078feff732a01ca8b6.js" async=""></script></body></html>