<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.60c3ca86afa5e5c4da02.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}blockquote{background:#ededed;border-left:8px solid #5d93ff;box-shadow:0 3px 15px rgba(0,0,0,.15);color:#222;font-size:1.1em;font-style:italic;font-weight:300;line-height:1.6;margin:0;padding:1.2em;position:relative;vertical-align:super;z-index:0;overflow:hidden;text-align:start}blockquote:before{color:#5d93ff;content:"\201C";font-size:5em;left:0;position:absolute;top:-35px}blockquote p:before{color:#ddd;content:"\201C";font-size:50em;line-height:.65em;right:.095em;position:absolute;z-index:-1}blockquote span{color:#5d93ff;display:block;font-size:1.4em;font-weight:300;letter-spacing:.0625rem;margin-top:.5em}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism{color:#222}.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-contact--8_j8F{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.21.9"/><link rel="alternate" type="application/rss+xml" title="Piotr Mionskowski" href="/feed.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-49294874-1"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-49294874-1', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=6c7ff033d8d3a409da0f2d709d5b2f23"/><title data-react-helmet="true">How to convert an express app to AWS Lambda? - Piotr Mionskowski</title><meta data-react-helmet="true" name="description" content="In this post we will see how to convert an existing express application to AWS Lambda. This can help reduce AWS bill even by an order of magnitude. We will also use cloudform to describe the CloudFormation stack.  An express app For our example to be complete we need an express application. Let’s use a single  file to…"/><meta data-react-helmet="true" property="og:site_name" content="How to convert an express app to AWS Lambda? - Piotr Mionskowski"/><meta data-react-helmet="true" property="og:image" content="https://miensol.pl//[object Object]"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="How to convert an express app to AWS Lambda? - Piotr Mionskowski"/><meta data-react-helmet="true" name="twitter:description" content="In this post we will see how to convert an existing express application to AWS Lambda. This can help reduce AWS bill even by an order of magnitude. We will also use cloudform to describe the CloudFormation stack.  An express app For our example to be complete we need an express application. Let’s use a single  file to…"/><meta data-react-helmet="true" name="twitter:image" content="https://miensol.pl//[object Object]"/><link as="script" rel="preload" href="/webpack-runtime-81078feff732a01ca8b6.js"/><link as="script" rel="preload" href="/framework-ff21b39501fa5007c91d.js"/><link as="script" rel="preload" href="/532a2f07-5faf1395916999ba184f.js"/><link as="script" rel="preload" href="/app-6174af72088d24da11e8.js"/><link as="script" rel="preload" href="/styles-8636a280cbc61d53ad10.js"/><link as="script" rel="preload" href="/c39ba592b6b5047a9857340a927d4f5e647ac87b-a4bdae0c130dc607cbb4.js"/><link as="script" rel="preload" href="/70ba16277e1f8ff187315c677a20c57a8b12f94a-076ebef65155af783aeb.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js"/><link as="fetch" rel="preload" href="/page-data/how-to-convert-an-express-app-to-aws-lambda/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">How to convert an express app to AWS Lambda?</h1><div class="Content-module--content__body--2TrQ-"><p>In this post we will see how to convert an existing <a href="https://expressjs.com/" target="_blank" rel="nofollow noopener noreferrer">express</a> application to AWS Lambda. This can help reduce AWS bill even by an order of magnitude. We will also use <a href="https://github.com/bright/cloudform" target="_blank" rel="nofollow noopener noreferrer">cloudform</a> to describe the <a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="nofollow noopener noreferrer">CloudFormation</a> stack.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 465px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/46bc2ff2509d5263f6fb5067702578ae/51ce3/express-js.webp"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 30.41666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRkAAAABXRUJQVlA4IDQAAAAQAwCdASoUAAYAPtFUpEuoJKOhsAgBABoJaQAAetHZgAAA/vILBEmvF5np5yiEVejvgAAA'); background-size: cover; display: block;"
  ></span>
  <picture>
        <source
          srcset="/static/46bc2ff2509d5263f6fb5067702578ae/8ac56/express-js.webp 240w,
/static/46bc2ff2509d5263f6fb5067702578ae/51ce3/express-js.webp 465w"
          sizes="(max-width: 465px) 100vw, 465px"
          type="image/webp"
        />
        <source
          srcset="/static/46bc2ff2509d5263f6fb5067702578ae/8ac56/express-js.webp 240w,
/static/46bc2ff2509d5263f6fb5067702578ae/51ce3/express-js.webp 465w"
          sizes="(max-width: 465px) 100vw, 465px"
          type="image/webp"
        />
        <img
          class="gatsby-resp-image-image"
          src="/static/46bc2ff2509d5263f6fb5067702578ae/51ce3/express-js.webp"
          alt="lambda"
          title="lambda"
          loading="lazy"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        />
      </picture>
  </a>
    </span></p>
<h2 id="an-express-app" style="position:relative;"><a href="#an-express-app" aria-label="an express app permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>An express app</h2>
<p>For our example to be complete we need an express application. Let’s use a single <code class="language-text">index.js</code> file to define it:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">apiRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express<span class="token punctuation">.</span>Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    routes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/v1/version'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>version<span class="token operator">:</span> <span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    routes<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/v1/echo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>req<span class="token punctuation">.</span>body<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> routes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">apiRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on 3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The above application has only 2 endpoints: </p>
<ul>
<li><code class="language-text">GET /v1/version</code> returns API version</li>
<li><code class="language-text">POST /v1/echo</code> sends back the request body</li>
</ul>
<p>We start the application as any other node app with <code class="language-text">node index.js</code>.</p>
<h2 id="convert-the-express-app-to-aws-lambda" style="position:relative;"><a href="#convert-the-express-app-to-aws-lambda" aria-label="convert the express app to aws lambda permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Convert the express app to AWS Lambda</h2>
<p><a href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-prog-model-handler.html" target="_blank" rel="nofollow noopener noreferrer">The AWS Lambda Node.js</a> runtime model differs from a simple <code class="language-text">node fileName.js</code> invocation. For the AWS Lambda to invoke our application code we need to structure it appropriately. Thankfully the <a href="https://github.com/awslabs/aws-serverless-express" target="_blank" rel="nofollow noopener noreferrer">aws-serverless-express</a> module adapts express to AWS Lambda Node.js runtime model.</p>
<p>Let’s adapt our <code class="language-text">index.js</code> file to support <code class="language-text">aws-serverless-express</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> isInLambda <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LAMBDA_TASK_ROOT</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isInLambda<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> serverlessExpress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-serverless-express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> server <span class="token operator">=</span> serverlessExpress<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=></span> serverlessExpress<span class="token punctuation">.</span><span class="token function">proxy</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> event<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Listening on 3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-text">main</code> function is called by the AWS Lambda Node.js runtime. Note that we’ve used <a href="https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html#lambda-environment-variables" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">LAMBDA_TASK_ROOT</code></a> environment variable to detect if the app is running inside AWS Lambda. It is better to split the express application setup and <code class="language-text">listen</code> call into separate files and use 2 different <em>main</em> files e.g. <code class="language-text">development.js</code> calling <code class="language-text">listen(port)</code> and <code class="language-text">lambda.js</code> using <code class="language-text">aws-serverless-express</code>. However, this would complicate our example unnecessarily.</p>
<h2 id="deploy-the-express-app-to-aws-lambda" style="position:relative;"><a href="#deploy-the-express-app-to-aws-lambda" aria-label="deploy the express app to aws lambda permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploy the express app to AWS Lambda</h2>
<p>I already showed <a href="/deploy-lambda-with-cloudformation">how we can deploy lambda with cloudform</a>. We will use the previous example as a base:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> cloudform<span class="token punctuation">,</span> <span class="token punctuation">{</span> Lambda<span class="token punctuation">,</span> <span class="token constant">IAM</span><span class="token punctuation">,</span> Fn<span class="token punctuation">,</span> ApiGateway<span class="token punctuation">,</span> Refs<span class="token punctuation">,</span>  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cloudform'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> FunctionProperties <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cloudform/types/lambda/function'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> readFileSync <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span>
    LambdaExecutionRole <span class="token operator">=</span> <span class="token string">'LambdaExecutionRole'</span><span class="token punctuation">,</span>
    ExpressMain <span class="token operator">=</span> <span class="token string">'ExpressMain'</span><span class="token punctuation">,</span>
    RestApi <span class="token operator">=</span> <span class="token string">'RestApi'</span><span class="token punctuation">,</span>
    RestApiMainResource <span class="token operator">=</span> <span class="token string">'RestApiMainResource'</span><span class="token punctuation">,</span>
    PackageKey <span class="token operator">=</span> <span class="token string">'PackageKey'</span><span class="token punctuation">,</span>
    RestApiDeployment <span class="token operator">=</span> <span class="token string">'RestApiDeployment'</span><span class="token punctuation">,</span>
    RestApiMethod <span class="token operator">=</span> <span class="token string">'RestApiMethod'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">cloudform</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    Parameters<span class="token operator">:</span> <span class="token punctuation">{</span>
        PackageKey<span class="token operator">:</span> <span class="token punctuation">{</span>
            Type<span class="token operator">:</span> <span class="token string">'String'</span><span class="token punctuation">,</span>
            Default<span class="token operator">:</span> <span class="token string">'express-lambda.zip'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    Resources<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>ExpressMain<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lambda<span class="token punctuation">.</span>Function</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            Code<span class="token operator">:</span> <span class="token punctuation">{</span> S3Bucket<span class="token operator">:</span> <span class="token string">'bright-tmp'</span><span class="token punctuation">,</span> S3Key<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>PackageKey<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            Handler<span class="token operator">:</span> <span class="token string">"index.main"</span><span class="token punctuation">,</span>
            Role<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>LambdaExecutionRole<span class="token punctuation">,</span> <span class="token string">"Arn"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Runtime<span class="token operator">:</span> <span class="token string">"nodejs6.10"</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>LambdaExecutionRole<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">IAM<span class="token punctuation">.</span>Role</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            AssumeRolePolicyDocument<span class="token operator">:</span> <span class="token punctuation">{</span>
                Statement<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    Effect<span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
                    Principal<span class="token operator">:</span> <span class="token punctuation">{</span> Service<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lambda.amazonaws.com"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    Action<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"sts:AssumeRole"</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            ManagedPolicyArns<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        PermissionToInvokeLambda<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Lambda<span class="token punctuation">.</span>Permission</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            Action<span class="token operator">:</span> <span class="token string">'lambda:InvokeFunction'</span><span class="token punctuation">,</span>
            FunctionName<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>ExpressMain<span class="token punctuation">,</span> <span class="token string">'Arn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Principal<span class="token operator">:</span> <span class="token string">'apigateway.amazonaws.com'</span><span class="token punctuation">,</span>
            SourceArn<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
                <span class="token string">'arn:aws:execute-api:'</span><span class="token punctuation">,</span> Refs<span class="token punctuation">.</span>Region<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> Refs<span class="token punctuation">.</span>AccountId<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'/*'</span><span class="token punctuation">]</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token operator">...</span> <span class="token comment">// Rest Api Gateway see below</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>For the AWS Lambda function source we use a zip file hosted in a S3 Bucket named <code class="language-text">packages</code> at key specified in the template parameter <code class="language-text">PackageKey</code>. The package zip file must contain all application source code including <code class="language-text">node_modules</code>. We also define <code class="language-text">PermissionToInvokeLambda</code> so that API Gateway can invoke the lambda function.</p>
<h2 id="add-api-gateway-to-call-aws-lambda" style="position:relative;"><a href="#add-api-gateway-to-call-aws-lambda" aria-label="add api gateway to call aws lambda permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Add API Gateway to call AWS Lambda</h2>
<p>To be able to invoke the AWS Lambda function using HTTP protocol we will use <a href="https://aws.amazon.com/api-gateway/" target="_blank" rel="nofollow noopener noreferrer">API Gateway</a>. There are multiple ways of setting up the API gateway but we will use an appoach that is simplest in my opinion.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token punctuation">[</span>RestApi<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway<span class="token punctuation">.</span>RestApi</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Name<span class="token operator">:</span> <span class="token string">"Express API"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>RestApiMainResource<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway<span class="token punctuation">.</span>Resource</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    RestApiId<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">)</span><span class="token punctuation">,</span>
    ParentId<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">GetAtt</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">,</span> <span class="token string">'RootResourceId'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PathPart<span class="token operator">:</span> <span class="token string">"{proxy+}"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>RestApiMethod<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway<span class="token punctuation">.</span>Method</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    HttpMethod<span class="token operator">:</span> <span class="token string">'ANY'</span><span class="token punctuation">,</span>
    ResourceId<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApiMainResource<span class="token punctuation">)</span><span class="token punctuation">,</span>
    RestApiId<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">)</span><span class="token punctuation">,</span>
    AuthorizationType<span class="token operator">:</span> <span class="token string">'NONE'</span><span class="token punctuation">,</span>
    Integration<span class="token operator">:</span> <span class="token punctuation">{</span>
        Type<span class="token operator">:</span> <span class="token string">"AWS_PROXY"</span><span class="token punctuation">,</span>
        IntegrationHttpMethod<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
        Uri<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">"arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${ExpressMain.Arn}/invocations"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">[</span>RestApiDeployment<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ApiGateway<span class="token punctuation">.</span>Deployment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    RestApiId<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">)</span><span class="token punctuation">,</span>
    StageName<span class="token operator">:</span> <span class="token string">'test'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>We first define a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-restapi.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">RestApi</code></a> which is a collection of resources with various configuration options describing the API. Next is the <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-resource.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">RestApiMainResource</code></a> which depicts a single REST resource. However, in our case we use wildcard <code class="language-text">PathPart</code> to match <strong>all</strong> paths. This way we can have a single resource encompassing all API endpoints. For the <code class="language-text">RestApiMainResource</code> we also need to define a single <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-method.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">RestApiMethod</code></a>. Note that the <code class="language-text">HttpMethod</code> is set to <code class="language-text">ANY</code> which matches all verbs. The <code class="language-text">Integration</code> specifies that we would like to proxy requests to the <code class="language-text">ExpressMain</code> AWS Lambda function. Last but not least we define a <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-deployment.html" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">RestApiDeployment</code></a> so that we have an URL to call the API.</p>
<p>It is handy to define <code class="language-text">Outputs</code> in our template so that we can easily access the API url:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript">Outputs<span class="token operator">:</span> <span class="token punctuation">{</span>
    RestApiUrl<span class="token operator">:</span> <span class="token punctuation">{</span>
        Value<span class="token operator">:</span> Fn<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Fn<span class="token punctuation">.</span><span class="token function">Ref</span><span class="token punctuation">(</span>RestApi<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'.execute-api.'</span><span class="token punctuation">,</span> Refs<span class="token punctuation">.</span>Region<span class="token punctuation">,</span> <span class="token string">'.amazonaws.com/test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="test-api-gateway-calling-aws-lambda" style="position:relative;"><a href="#test-api-gateway-calling-aws-lambda" aria-label="test api gateway calling aws lambda permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Test API Gateway calling AWS Lambda</h2>
<p>With our cloudform template deployed with a single command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">aws cloudformation update-stack <span class="token punctuation">\</span>
  --stack-name lambda-example <span class="token punctuation">\</span>
  --capabilities CAPABILITY_IAM <span class="token punctuation">\</span>
  --template-body file://<span class="token operator">&lt;</span><span class="token punctuation">(</span>./node_modules/.bin/cloudform aws-template.ts<span class="token punctuation">)</span></code></pre></div>
<p>We can also fetch the API url:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">API_URL</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>aws cloudformation describe-stacks <span class="token punctuation">\</span>
  --stack-name lambda-example <span class="token punctuation">\</span>
  --query <span class="token string">'Stacks[0].Outputs[?OutputKey==<span class="token variable"><span class="token variable">`</span>RestApiUrl<span class="token variable">`</span></span>].OutputValue'</span> <span class="token punctuation">\</span>
  --output text<span class="token variable">)</span></span></code></pre></div>
<p>Finally, with the help of <a href="https://httpie.org/" target="_blank" rel="nofollow noopener noreferrer"><code class="language-text">httpie</code></a> we can test our API:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token operator">></span> http https://<span class="token variable">${API_URL}</span>/v1/version

HTTP/1.1 <span class="token number">200</span> OK
Connection: keep-alive
Content-Length: <span class="token number">15</span>
Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Date: Mon, <span class="token number">28</span> May <span class="token number">2018</span> <span class="token number">19</span>:58:13 GMT
Via: <span class="token number">1.1</span> XXXXXXXXXXXXX.cloudfront.net <span class="token punctuation">(</span>CloudFront<span class="token punctuation">)</span>
X-Amz-Cf-Id: <span class="token assign-left variable">XXXXXXXXXXXXX</span><span class="token operator">==</span>
X-Amzn-Trace-Id: <span class="token assign-left variable">Root</span><span class="token operator">=</span><span class="token number">1</span>-5b0c5f54-806e190d437c7d31a4a0d4ba
X-Cache: Miss from cloudfront
etag: W/<span class="token string">"f-sHigu4BMVa0IJ0LR3NDJ5y8l4sc"</span>
x-amz-apigw-id: HnPVQH4yjoEF8-w<span class="token operator">=</span>
x-amzn-Remapped-connection: close
x-amzn-Remapped-content-length: <span class="token number">15</span>
x-amzn-Remapped-date: Mon, <span class="token number">28</span> May <span class="token number">2018</span> <span class="token number">19</span>:58:13 GMT
x-amzn-RequestId: 73eff8a6-62b1-11e8-907c-79117668835e
x-powered-by: Express

<span class="token punctuation">{</span>
    <span class="token string">"version"</span><span class="token builtin class-name">:</span> <span class="token string">"1"</span>
<span class="token punctuation">}</span></code></pre></div>
<p>And a <code class="language-text">POST</code> to the echo endpoint:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">http https://<span class="token variable">${API_URL}</span>/v1/echo <span class="token assign-left variable">message</span><span class="token operator">=</span><span class="token string">"Hello 👋 My name is Piotr"</span>

HTTP/1.1 <span class="token number">200</span> OK
Connection: keep-alive
Content-Length: <span class="token number">41</span>
Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Date: Mon, <span class="token number">28</span> May <span class="token number">2018</span> <span class="token number">20</span>:00:31 GMT
Via: <span class="token number">1.1</span> XXXXXXXXXXXXX.cloudfront.net <span class="token punctuation">(</span>CloudFront<span class="token punctuation">)</span>
X-Amz-Cf-Id: <span class="token assign-left variable">XXXXXXXXXXXXX</span><span class="token operator">==</span>
X-Amzn-Trace-Id: <span class="token assign-left variable">Root</span><span class="token operator">=</span><span class="token number">1</span>-5b0c5fdf-802178cceb5160684ef2cc34
X-Cache: Miss from cloudfront
etag: W/<span class="token string">"29-SKqhJThIfjmVId6IIeTilD7Mkk0"</span>
x-amz-apigw-id: <span class="token assign-left variable">HnPq5HeJjoEFuRQ</span><span class="token operator">=</span>
x-amzn-Remapped-connection: close
x-amzn-Remapped-content-length: <span class="token number">41</span>
x-amzn-Remapped-date: Mon, <span class="token number">28</span> May <span class="token number">2018</span> <span class="token number">20</span>:00:31 GMT
x-amzn-RequestId: c67b41c0-62b1-11e8-a23f-c7cbebde15f2
x-powered-by: Express

<span class="token punctuation">{</span>
    <span class="token string">"message"</span><span class="token builtin class-name">:</span> <span class="token string">"Hello 👋 My name is Piotr"</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="reduced-infrastructure-cost" style="position:relative;"><a href="#reduced-infrastructure-cost" aria-label="reduced infrastructure cost permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reduced infrastructure cost</h2>
<p>With the above setup we no longer have to pay for an always running EC2 instance. Our monthly bill depends on the number of requests that are executed against the exposed API. More than that, we get much better scalability characteristics, especially when we have nonlinear request rates. </p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->29 May 2018</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/aws/">aws</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cloudformation/">cloudformation</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/lambda/">lambda</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cloudform/">cloudform</a></li></ul></div><div class="Author-module--author--2Yefr"><p>TDD fan eager to learn new things. Always focused, always eager to ask why?<a class="Author-module--author__bio-contact--8_j8F" href="mailto:piotr.mionskowski@gmail.com" rel="noopener noreferrer" target="_blank"><strong>Piotr Mionskowski</strong></a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/how-to-convert-an-express-app-to-aws-lambda/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-6174af72088d24da11e8.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-78521276b246725d0e0f.js"],"component---src-templates-categories-list-template-tsx":["/component---src-templates-categories-list-template-tsx-1443a27db8e607e06eaf.js"],"component---src-templates-category-template-tsx":["/component---src-templates-category-template-tsx-9b2527fed1bbc12d167a.js"],"component---src-templates-index-template-tsx":["/component---src-templates-index-template-tsx-90ea64a37c4d7b280402.js"],"component---src-templates-not-found-template-tsx":["/component---src-templates-not-found-template-tsx-3d89186c897c9782220b.js"],"component---src-templates-page-template-tsx":["/component---src-templates-page-template-tsx-daedb109729ccd084ce5.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js"],"component---src-templates-tag-template-tsx":["/component---src-templates-tag-template-tsx-0485877a475bb21e2d32.js"],"component---src-templates-tags-list-template-tsx":["/component---src-templates-tags-list-template-tsx-82656016ea107e26a0f3.js"]};/*]]>*/</script><script src="/component---src-templates-post-template-tsx-c32fd150628cfd6dfdcc.js" async=""></script><script src="/70ba16277e1f8ff187315c677a20c57a8b12f94a-076ebef65155af783aeb.js" async=""></script><script src="/c39ba592b6b5047a9857340a927d4f5e647ac87b-a4bdae0c130dc607cbb4.js" async=""></script><script src="/styles-8636a280cbc61d53ad10.js" async=""></script><script src="/app-6174af72088d24da11e8.js" async=""></script><script src="/532a2f07-5faf1395916999ba184f.js" async=""></script><script src="/framework-ff21b39501fa5007c91d.js" async=""></script><script src="/webpack-runtime-81078feff732a01ca8b6.js" async=""></script></body></html>