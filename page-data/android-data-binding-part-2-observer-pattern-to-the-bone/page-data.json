{"componentChunkName":"component---src-templates-post-template-tsx","path":"/android-data-binding-part-2-observer-pattern-to-the-bone/","result":{"data":{"markdownRemark":{"id":"e9ee4a0b-3066-594f-8a91-7876c04ce6ab","html":"<p>In the <a href=\"/android-data-binding-part-1-why-it-is-important\">previous part</a> I’ve described typical problems we have to face when developing applications on Android. I’ve also highlighted that some of them may be mitigated when <a href=\"https://developer.android.com/tools/data-binding/guide.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">data binding API</a> is utilized properly. It’s time to dive into more details of how this promising API works.</p>\n<h2 id=\"observer-pattern\" style=\"position:relative;\"><a href=\"#observer-pattern\" aria-label=\"observer pattern permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Observer Pattern</h2>\n<p>At the root of many of solutions we find in today’s APIs is a design pattern. In case of the discussed Android API it is <a href=\"https://en.wikipedia.org/wiki/Observer_pattern\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Observer Pattern</a> applied to the bone. In fact this particular pattern is so common and powerful that some languages and runtimes (C# with .NET, Objective-C and Swift on iOS and Mac) provide neat support for it. You may wonder why it is important in the context of Android data binding? The answer is simple yet easy to ignore - memory management. The following diagram depicts dependencies of an observer pattern’s elements in the context of Android data binding:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.916666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC10lEQVQoz42R20+ScRjH32GKwstZSJGznM8wXlDkYMA4aCPFuYa2eUBgLQaE2mJOWgMUXGUCxWG18ALXTVuti8obL7qtyy76F1qX3dPz2rVbz/bZ83t++z7f5/c+L1Iul6+nUilrOp22ZrNZcy6XM0DGMpmMGb+DWnx6espoNpusQqFAOTg4oFQqFcrJyQm5Wq2ieF0sFintdpvUarVIiN1uR+fm5sbC4fBYIBDgeT0ejdfrlc3Pz/MjkQjXZDLRDw8PmbncNhPDrGgoFGL4fD6Wy+XigY7l9/sZwWAQh9jtdhmIXq+nqVQqVKFQoAaDga9UKnlanY6v1WrZEAMkEmlwfWNDePzsqXrKZmODRgRDBIAYEBmNRnwoSqVSiWdnZ1REIpGgGIaJLBaLQKfXcxcXF5ROp3MCRFy450mlUlo+n+ccHVU5GrVaCg8Qq9VqDsCCh7DkcjkdzjQul0vs9Xq0S0OHw0GGZhTEZLfbzbfZrGyYTLXbp5kymYyxs7Mzju8nGo1S4vE4LRaL0QHa5uYmnkfX1tYYCATskYaYDHqxTq+VmcxGmQ3DFEq1YtJsNkqsmEWm0amFSqWck9iKSY6PjynQLEwmk/JEIoEjAqSABpiEn3YNDMm48chu5qE0cjM6jiADlAf38wp/cImFoKO0UqEilmtvDW1t7461O51L8VUBXzAIDCO/MgvMRxm/6mnOK+5nlxmlVFD1Jh0UfL8bZO8lvNpW3CP8th3jtZsvmLV6g1yv1ykA2mg0UDzXajW8JoMZHRhBJI9NJN5rz/nEqxvP8Ulwfs9tO1cFbadH1A384HScG30EIZT2Q0P7H84JneZLAjReBTj0Pg/YyrftU8UVfSh5j2WqLE9PFe5IZ/ZWVYYnS35laUXWZyLDv00IAfmf+OkWMD95Z8XvQh7p2wWH5GLWJfgYcoh6YZ/i68ys8It/RvDHRqT32f/0F7l1fF9X8hdrgPQPgRr7CQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/ccd052e87f97e39eeef0e6f724a64e42/8ac56/android_data_binding_diagram.webp 240w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/d3be9/android_data_binding_diagram.webp 480w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/e46b2/android_data_binding_diagram.webp 960w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/0b716/android_data_binding_diagram.webp 1296w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/ccd052e87f97e39eeef0e6f724a64e42/8ff5a/android_data_binding_diagram.png 240w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/e85cb/android_data_binding_diagram.png 480w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/d9199/android_data_binding_diagram.png 960w,\n/static/ccd052e87f97e39eeef0e6f724a64e42/86a1e/android_data_binding_diagram.png 1296w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/ccd052e87f97e39eeef0e6f724a64e42/d9199/android_data_binding_diagram.png\"\n          alt=\"Android data binding diagram\"\n          title=\"Android data binding diagram\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n    </span>\nOn the right side we have the <em>observable</em> part producing notifications about changes - an object implementing <code class=\"language-text\">android.databinding.Observable</code> interface. In the observer pattern <em>events producer</em> can have many <em>events listeners</em> - <code class=\"language-text\">OnPropertyChangedCallback</code> implementations. Android data binding provides implementations of <em>events listeners</em> taking care of property values changes as well as collection elements changes.</p>\n<p>Note that the <code class=\"language-text\">Observable</code> object knows nothing about concrete <code class=\"language-text\">OnPropertyChangedCallback</code> implementations (<a href=\"https://en.wikipedia.org/wiki/Dependency_inversion_principle\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dependency Inversion Principle</a> at its best). However, at runtime the <code class=\"language-text\">Observable</code> object will hold references to many <code class=\"language-text\">OnPropertyChangedCallback</code>s instances. If you look further down the diagram you’ll see that in order for <code class=\"language-text\">OnPropertyChangedCallback</code> implementations provided by Android data binding library to update the state of the view component a reference to it is required. This means that although the view model knows nothing about the view components at compile time they will reference them at runtime.</p>\n<h2 id=\"how-android-data-binding-library-aids-memory-management\" style=\"position:relative;\"><a href=\"#how-android-data-binding-library-aids-memory-management\" aria-label=\"how android data binding library aids memory management permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How Android data binding library aids memory management?</h2>\n<p>As stated above in a simple implementation we would have a lightweight and testable view model retain expensive view widgets - thus making it heavy. In the Android context it means that even though an <code class=\"language-text\">Activity</code> got destroyed we could have other object still retaining its <code class=\"language-text\">Views</code>, trying to update them and preventing them from being garbage collected. Not so nice, huh?</p>\n<p>If you look closer at how Android data binding is implemented you’ll immediately see that its <code class=\"language-text\">OnPropertyChangedCallback</code> holds only <a href=\"http://developer.android.com/reference/java/lang/ref/WeakReference.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">weak references</a> to views.\n<code class=\"language-text\">WeakPropertyListener</code>, <code class=\"language-text\">WeakListListener</code>, <code class=\"language-text\">WeakMapListener</code> and <code class=\"language-text\">ViewDataBinding.WeakListener</code> make sure that the <code class=\"language-text\">Observable</code> object is not retaining views. This means that there’s no need for a developer to manually <em>stop</em> data binding in an activity <code class=\"language-text\">onDestroy</code> or a fragment <code class=\"language-text\">onDestroyView</code> methods. If you use <a href=\"https://github.com/ReactiveX/RxJava\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">RxJava</a> you probably know that this extra step is tedious and requires a great deal of attention and boilerplate code. You can find out more about the problem in at least couple of issues on GitHub: <a href=\"https://github.com/ReactiveX/RxJava/issues/386\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">1</a>, <a href=\"https://github.com/ReactiveX/RxAndroid/issues/12\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">2</a>.</p>\n<p>Because Android data binding library takes extra steps to make sure a view model will not cause views to be retained we can detach a view model’s lifecycle from that of an activity or a fragment. We now have an easy way to i.e. do a simple in-memory caching via singleton view models. More importantly, we can cross out at least one place when looking for a memory leak cause.</p>\n<p><em>This article is cross-posted with <a href=\"http://blog.brightinventions.pl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">my company blog</a></em></p>","fields":{"slug":"/android-data-binding-part-2-observer-pattern-to-the-bone/","tagSlugs":["/tag/android/"]},"excerpt":"In the previous part I’ve described typical problems we have to face when developing applications on Android. I’ve also highlighted that some of them may be mitigated when data binding API is utilized properly. It’s time to dive into more details of how this promising API works. Observer Pattern At the root of many of…","frontmatter":{"date":"2015-07-27 08:45","description":null,"tags":["android"],"title":"Android Data Binding Part 2: Observer pattern to the bone","socialImage":null}}},"pageContext":{"slug":"/android-data-binding-part-2-observer-pattern-to-the-bone/"}}}