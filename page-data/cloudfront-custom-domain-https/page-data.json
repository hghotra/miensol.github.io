{"componentChunkName":"component---src-templates-post-template-tsx","path":"/cloudfront-custom-domain-https/","result":{"data":{"markdownRemark":{"id":"800b7cee-646f-58e8-8223-6b16c3181ab0","html":"<p><a href=\"../fast-static-website-with-aws-cdk\">The static website deployed with aws-cdk to CloudFront post</a>\nshows how to deploy static content with aws-cdk. We still miss a custom domain configuration for\nour website though. The following example shows how to:</p>\n<ul>\n<li>setup a custom domain name for a CloudFront distribution</li>\n<li>enable https using AWS issued trusted certificate</li>\n</ul>\n<h2 id=\"get-a-trusted-certificate-from-aws-certificate-manager-using-aws-cdk\" style=\"position:relative;\"><a href=\"#get-a-trusted-certificate-from-aws-certificate-manager-using-aws-cdk\" aria-label=\"get a trusted certificate from aws certificate manager using aws cdk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get a trusted certificate from AWS Certificate Manager using aws-cdk</h2>\n<p>Using the <a href=\"https://github.com/miensol/miensol.github.io/tree/develop/content/posts/cloudfront-custom-domain-https\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">example from previous post as a base</a>, inside <code class=\"language-text\">infrastructure</code> directory, let’s add\nadditional package:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token function\">npm</span> i --save @aws-cdk/aws-certificatemanager</code></pre></div>\n<p>CloudFront can only use AWS Certificate Manager issued certificates inside us-east-1 region (N. Virginia).\nWe can create our <code class=\"language-text\">FrontendStack</code> in us-east-1 region. Alternatively we can create another stack with the certificate only.\nBelow I show how to use the second option.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ValidationMethod <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@aws-cdk/aws-certificatemanager\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cm <span class=\"token keyword\">from</span> <span class=\"token string\">\"@aws-cdk/aws-certificatemanager\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> domainName <span class=\"token operator\">=</span> <span class=\"token string\">\"fast-static-website.miensol.pl\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CertificateStack</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>Stack</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">scope<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>Construct</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> <span class=\"token string\">\"CertificateStack\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      env<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> region<span class=\"token operator\">:</span> <span class=\"token string\">\"us-east-1\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> certificate <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cm<span class=\"token punctuation\">.</span>Certificate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CustomDomainCertificate\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      domainName<span class=\"token operator\">:</span> domainName<span class=\"token punctuation\">,</span>\n      validationMethod<span class=\"token operator\">:</span> ValidationMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">DNS</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> certificateArn <span class=\"token operator\">=</span> certificate<span class=\"token punctuation\">.</span>certificateArn<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">CfnOutput</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"CertificateArn\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token operator\">:</span> certificateArn<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>We request a certificate for a given domain name in us-east-1 region.\nBefore AWS Certificate Manager issues a trusted TLS certificate it needs to verify that you own\nthe domain. The validation happens using either:</p>\n<ul>\n<li>email: AWS CM sends a message to <em>admin</em> email addresses for the domain</li>\n<li>DNS: AWS CM requests a particular DNS record configuration</li>\n</ul>\n<p>In the example above I use <code class=\"language-text\">fast-static-website.miensol.pl</code> with DNS validation method. Since I own\nthe domain I can prove that to AWS Certificate Manager.</p>\n<p>We also update the <code class=\"language-text\">bin/infrastructure.ts</code> file to include our new stack:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">#<span class=\"token operator\">!</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>env node\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"source-map-support/register\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cdk <span class=\"token keyword\">from</span> <span class=\"token string\">\"@aws-cdk/core\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> CertificateStack<span class=\"token punctuation\">,</span> FrontendStack <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../lib/frontend-stack\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">CertificateStack</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">FrontendStack</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Let’s trigger next deployment with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token function\">npm</span> run cdk deploy <span class=\"token string\">'*'</span></code></pre></div>\n<p>The process will wait for a certificate request validation. The requested DNS\nrecord will show up in the deployment command output:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token operator\">></span> <span class=\"token function\">npm</span> run cdk deploy\n<span class=\"token punctuation\">..</span>.\n<span class=\"token number\">1</span>/5 <span class=\"token operator\">|</span> <span class=\"token number\">6</span>:03:37 PM <span class=\"token operator\">|</span> CREATE_IN_PROGRESS   <span class=\"token operator\">|</span> AWS::CertificateManager::Certificate\n <span class=\"token operator\">|</span> CustomDomainCertificate <span class=\"token punctuation\">(</span>CustomDomainCertificateXXXXX<span class=\"token punctuation\">)</span> Content of DNS Record is: <span class=\"token punctuation\">{</span>Name: XXXXXX.fast-static-website.miensol.pl.,Type: CNAME,Value: XXXXX.auiqqraehs.acm-validations.aws.<span class=\"token punctuation\">}</span>\n<span class=\"token number\">1</span>/5 Currently <span class=\"token keyword\">in</span> progress: CustomDomainCertificateXXXXX</code></pre></div>\n<p>You can also find the request in <a href=\"https://eu-central-1.console.aws.amazon.com/acm/home?region=eu-central-1#/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Certificate Manager</a> inside AWS Web console. After\nyou configure the DNS record, the process will continue. In the command output you should see a message similar to:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">CertificateStack.CertificateArn <span class=\"token operator\">=</span> arn:aws:acm:us-east-1:XXXXXXX:certificate/XXXXX-XXXXX-XXXX-XXXX-XXXXXXXX</code></pre></div>\n<p>Please note the above value, we will need it in the following step.</p>\n<h2 id=\"attach-a-certificate-to-cloudfront-distribution-using-aws-cdk\" style=\"position:relative;\"><a href=\"#attach-a-certificate-to-cloudfront-distribution-using-aws-cdk\" aria-label=\"attach a certificate to cloudfront distribution using aws cdk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Attach a certificate to CloudFront distribution using aws-cdk</h2>\n<p>We need to tell the CloudFront distribution to use the new certificate. Let’s modify the <code class=\"language-text\">FrontendStack</code>\nto accept parameters:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">FrontendProps</span> <span class=\"token punctuation\">{</span>\n  certificateArn<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FrontendStack</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>Stack</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">scope<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>Construct<span class=\"token punctuation\">,</span> props<span class=\"token operator\">:</span> FrontendProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> <span class=\"token string\">\"FrontendStack\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> frontBucket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">s3<span class=\"token punctuation\">.</span>Bucket</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"FrontendBucket\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      websiteIndexDocument<span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span>\n      publicReadAccess<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> distribution <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cloudfront<span class=\"token punctuation\">.</span>CloudFrontWebDistribution</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"Distribution\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        viewerCertificate<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          aliases<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>domainName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            acmCertificateArn<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>certificateArn<span class=\"token punctuation\">,</span>\n            sslSupportMethod<span class=\"token operator\">:</span> <span class=\"token string\">\"sni-only\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>In the <code class=\"language-text\">viewerCertificate</code> section we specify domain name as well as certificate CloudFront distribution should use.\nNext we pass CertificateStack.CertificateArn value noted above as a parameter:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">CertificateStack</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">FrontendStack</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  certificateArn<span class=\"token operator\">:</span>\n    <span class=\"token string\">\"arn:aws:acm:us-east-1:XXXXXXX:certificate/XXXXX-XXXXX-XXXX-XXXX-XXXXXXXX\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The deployment will take a while to complete since the CF distribution has to update.\nWe can use that time to configure <code class=\"language-text\">fast-static-website.miensol.pl</code> DNS record.\nThe record needs to point to <code class=\"language-text\">FrontendStack.DistributionDomainName</code>.\nI use CloudFlare so in my case this means creating a CNAME record:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/99ad63bc35281463c74de3c1f9ddf8cd/a4f52/cloudflare-dns-entry.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.750000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA+UlEQVQY052QvW7EIBCEef8ibV4lXR4iTRpfcZHOmLPBxgabHzM3IOWvSBOkkUfe5WN3hNEa4zhinucmYwxKKTjP87f4r/yhn0doF2B9gHMO+77z65FybsXa29R8QSY4s9ZUPRVjxPX6ge5ywTRpiJtU6AcFKSXU/Q7DKdd1hVLqS8MwcIsJIYQGPwkskZ6w6p3feWfDwbqwy4KqiWv7bYMjLBwHX5ua6uT1Ae89AgHeLsiW8cgepr81j5y+V14JqYCV2W2czjJTXwFc31qLjfVPYEwJ3mgkPWJhX+2tngDklnuBwH8Os8OxAylCMa6u6/D08obn13c8AFzs0JhyGk0/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/99ad63bc35281463c74de3c1f9ddf8cd/8ac56/cloudflare-dns-entry.webp 240w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/d3be9/cloudflare-dns-entry.webp 480w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/e46b2/cloudflare-dns-entry.webp 960w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/f992d/cloudflare-dns-entry.webp 1440w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/882b9/cloudflare-dns-entry.webp 1920w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/f2636/cloudflare-dns-entry.webp 2024w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/99ad63bc35281463c74de3c1f9ddf8cd/8ff5a/cloudflare-dns-entry.png 240w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/e85cb/cloudflare-dns-entry.png 480w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/d9199/cloudflare-dns-entry.png 960w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/07a9c/cloudflare-dns-entry.png 1440w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/29114/cloudflare-dns-entry.png 1920w,\n/static/99ad63bc35281463c74de3c1f9ddf8cd/a4f52/cloudflare-dns-entry.png 2024w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/99ad63bc35281463c74de3c1f9ddf8cd/d9199/cloudflare-dns-entry.png\"\n          alt=\"cloudflare cname entry\"\n          title=\"cloudflare cname entry\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>We can now load our static website using HTTPS!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4fd2271fa5155b57a072b2e79721396b/0ef7e/certificate.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.58333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC8UlEQVQ4y42Uy24cVRCG/QoQFsieiefW3acv0/eZ6e7pGffc7TjYioYQYGFioRg5JlHsDSiCAFI2IBASCMQKRUgseQCegAUSr/Rxum3H44wTWPyq6jpVf/9V57Li+W06UUq70yWKe2d+QkM1qDWEtDqKZqIKS8JEWYKFInPrio5l+6xoZoBq+JegmSG98RbJaBs3GqDYERU9oCpRN5Zh+Cm6FZBzrQgrZBF50HA6lNMDGtNjrBsnaNkR6sYhanafa51DXmsfci06krjP69EDGvEc3XTRZL0kDLjAKamquwx23+fD48+ZDjYZZ1MmwxmTwYxRf4Lud6kIv1BcNcJCgCgUhhcKc2V50LDbrFc1Th5/xd///MXtzTGTJGaQJCRNk9QQWIaBLgSmtI1aDU3OUW+2Lrd8SnjWclP6hiOtj+7aBK6LK3SEorG+XqNSqVOp1qlWG8V3nqs3w6sITwdr2C3qdYVqpUq5dJ3V1RJra2VKEuWSRO7LeHltldKbb6Dr5n8otEOajrSWh+m2MFspRqePkQzR46zwTa+FCOQ80/cwgwHC9M835aqWQxw/wglivP4MJ7uBP/8A9+19/HcPcG/ewZWb05zew9r6VP5gWxK6y4SLpPl5VMRp0vDJD0y+/pXs8XeMnv5CdPcRwXwfb7pDY/06mpxhnidedg4LX85E1RzCW3ukR58xkqTbP//B+Muf2Hn2J92PPinWhTz0wmoVZK9UWBCqTeL9Y9p3Dtj8/ndGX/zI7NvfaL9zj2jvwaX8c39JoTiTvpjojHbZOHlKOL/L7JtnxLLlaO8hmu4t1b685XNIpUpNx5vN6X38BLOdFTFNzlgs5F6p8MVNeQ75nW+QKhUVdmFNkbHFuisVmvL6DSc36fanpNmM4fQt6U9IeuPCbgy36Ev08ns+2yHsbBTkr2zZ8ROaXiwR4bV6+MkIrzvG703xogzbj4t1L0yx5OPwP1s+s/IVsYc72ONd3K3bmPGoeJGKURTv50Xdv4yDRRPEeR0DAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/4fd2271fa5155b57a072b2e79721396b/8ac56/certificate.webp 240w,\n/static/4fd2271fa5155b57a072b2e79721396b/d3be9/certificate.webp 480w,\n/static/4fd2271fa5155b57a072b2e79721396b/e46b2/certificate.webp 960w,\n/static/4fd2271fa5155b57a072b2e79721396b/f992d/certificate.webp 1440w,\n/static/4fd2271fa5155b57a072b2e79721396b/f4029/certificate.webp 1594w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/4fd2271fa5155b57a072b2e79721396b/8ff5a/certificate.png 240w,\n/static/4fd2271fa5155b57a072b2e79721396b/e85cb/certificate.png 480w,\n/static/4fd2271fa5155b57a072b2e79721396b/d9199/certificate.png 960w,\n/static/4fd2271fa5155b57a072b2e79721396b/07a9c/certificate.png 1440w,\n/static/4fd2271fa5155b57a072b2e79721396b/0ef7e/certificate.png 1594w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/4fd2271fa5155b57a072b2e79721396b/d9199/certificate.png\"\n          alt=\"certificate\"\n          title=\"certificate\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>It is a shame that it is not possible to create <a href=\"https://github.com/aws/aws-cdk/issues/49#issuecomment-454800305\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cross region references using aws-cdk</a>:</p>\n<blockquote>\n<p>There is not, unfortunately. You’re going to have to thread the API URL across regions manually. That means:</p>\n<p>Deploy the ApiStackIreland first. Note the API URL (maybe make it an Output so that it’s easy to get to).\nDeploy the EdgeStack and plug in the value of API URL from the first step.\nThere are a number of ways you could do this, and honestly I’m not sure which one to recommend.</p>\n<p>I guess a pragmatic one would be to use <code class=\"language-text\">this.node.getContext()</code> and pass the value on the command-line when deploying the second stack (using the <code class=\"language-text\">-c KEY=VALUE fflag</code>), or put it into cdk.json under the context: {} section.</p>\n</blockquote>\n<p>The full working example is available <a href=\"https://github.com/miensol/miensol.github.io/tree/develop/content/posts/cloudfront-custom-domain-https\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">in the github repository</a>.</p>","fields":{"slug":"/cloudfront-custom-domain-https/","tagSlugs":["/tag/aws/","/tag/aws-cdk/","/tag/website/","/tag/infrastructure-as-code/","/tag/cloud-front/","/tag/aws-certificate-manager/"]},"excerpt":"The static website deployed with aws-cdk to CloudFront post\nshows how to deploy static content with aws-cdk. We still miss a custom domain configuration for\nour website though. The following example shows how to: setup a custom domain name for a CloudFront distribution enable https using AWS issued trusted certificate…","frontmatter":{"date":"2020-05-05T00:00:00.000Z","description":null,"tags":["aws","aws-cdk","website","infrastructure as code","CloudFront","AWS Certificate Manager"],"title":"HTTPs on CloudFront using Certificate Manager and aws-cdk","socialImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAHiNfIWIsbf/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIDERIAEP/aAAgBAQABBQJRbFK8gfImlUtpO//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPwG4r//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAECAQE/Aaf/xAAcEAABAwUAAAAAAAAAAAAAAAAAASExAxARInH/2gAIAQEABj8CHTFoQ2pv0g//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMUFhgZH/2gAIAQEAAT8hXBOsR9NcyqmMOUdTu5MEm/s//9oADAMBAAIAAwAAABA83//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxAIxLF//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxBE8sb/xAAcEAEBAQACAwEAAAAAAAAAAAABEQAhQTFRYbH/2gAIAQEAAT8QRFXwwqDyThrAOjHADZULzZff3Jk3oq/uYsc//9k=","aspectRatio":1.3333333333333333,"src":"/static/b26fab00cdfefd007568b3fd0850f29f/a6352/speed.jpg","srcSet":"/static/b26fab00cdfefd007568b3fd0850f29f/40426/speed.jpg 240w,\n/static/b26fab00cdfefd007568b3fd0850f29f/9104c/speed.jpg 480w,\n/static/b26fab00cdfefd007568b3fd0850f29f/a6352/speed.jpg 960w,\n/static/b26fab00cdfefd007568b3fd0850f29f/7f945/speed.jpg 1440w,\n/static/b26fab00cdfefd007568b3fd0850f29f/d8255/speed.jpg 1920w,\n/static/b26fab00cdfefd007568b3fd0850f29f/347e9/speed.jpg 4608w","sizes":"(max-width: 960px) 100vw, 960px"}}}}}},"pageContext":{"slug":"/cloudfront-custom-domain-https/"}}}