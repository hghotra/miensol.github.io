{"componentChunkName":"component---src-templates-post-template-tsx","path":"/fast-static-website-with-aws-cdk/","result":{"data":{"markdownRemark":{"id":"570be976-9470-5d88-8d5e-e98c35c64c72","html":"<p>In this post we’ll see how to create and deploy a static website using IaC using the following technologies:</p>\n<ul>\n<li>aws-cdk</li>\n<li>AWS CloudFormation</li>\n<li>AWS Lambda</li>\n<li>AWS S3</li>\n</ul>\n<h2 id=\"have-a-static-website\" style=\"position:relative;\"><a href=\"#have-a-static-website\" aria-label=\"have a static website permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Have a static website</h2>\n<p>For the sake of simplicity we’ll use <a href=\"https://create-react-app.dev/docs/adding-typescript/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Create React App</a> in a directory called <code class=\"language-text\">my-project</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token builtin class-name\">cd</span> my-project\nnpx create-react-app frontend --template typescript</code></pre></div>\n<p>Create the static website content inside <code class=\"language-text\">frontend/build</code> directory with:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token builtin class-name\">cd</span> frontend <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">yarn</span> build</code></pre></div>\n<h2 id=\"add-aws-cdk-to-the-project\" style=\"position:relative;\"><a href=\"#add-aws-cdk-to-the-project\" aria-label=\"add aws cdk to the project permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add aws-cdk to the project</h2>\n<p>Create infrastructure project with <a href=\"https://docs.aws.amazon.com/cdk/latest/guide/home.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">aws-cdk</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token function\">mkdir</span> infrastructure <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> infrastructure\nnpx cdk init --language typescript</code></pre></div>\n<p>Note that in order to deploy you need to have AWS API credentials configured.\nI prefer using AWS profiles, which you can set up using AWS CLI:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">aws configure --profile my-profile-name</code></pre></div>\n<p>The command will ask you couple of questions.\nPlease find the AWS Access Key Id and AWS Secret Access Key for your AWS account in <a href=\"https://console.aws.amazon.com/iam/home?region=eu-central-1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AWS Web Console IAM section</a>.\nThe AWS CLI stores configuration under <code class=\"language-text\">~/.aws</code> (Linux or Mac) or <code class=\"language-text\">%USERPROFILE%\\.aws</code> (Windows).</p>\n<p>Please follow aws-cdk <a href=\"https://docs.aws.amazon.com/cdk/latest/guide/getting_started.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Getting Started</a> to get more details.</p>\n<h2 id=\"deploy-static-content-deployment-to-s3-website\" style=\"position:relative;\"><a href=\"#deploy-static-content-deployment-to-s3-website\" aria-label=\"deploy static content deployment to s3 website permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy static content deployment to S3 website</h2>\n<p>We will deploy static content to AWS using <code class=\"language-text\">@aws-cdk/aws-s3-deployment</code> package. We need to add it to our project:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token builtin class-name\">cd</span> infrastructure\n<span class=\"token function\">npm</span> i --save @aws-cdk/aws-s3-deployment</code></pre></div>\n<p>Next, let’s tell aws-cdk to deploy contents of <code class=\"language-text\">frontend/build</code> directory to AWS.\nIn our template we have <code class=\"language-text\">InfrastructureStack</code> available under <code class=\"language-text\">lib/infrastructure-stack.ts</code>.\nSince it makes sense to have more focused CloudFormation stacks let’s rename it to <code class=\"language-text\">FrontendStackStack</code>. </p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cdk <span class=\"token keyword\">from</span> <span class=\"token string\">'@aws-cdk/core'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> s3 <span class=\"token keyword\">from</span> <span class=\"token string\">'@aws-cdk/aws-s3'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> s3deploy <span class=\"token keyword\">from</span> <span class=\"token string\">'@aws-cdk/aws-s3-deployment'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cloudfront <span class=\"token keyword\">from</span> <span class=\"token string\">'@aws-cdk/aws-cloudfront'</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">'path'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FrontendStack</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>Stack</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">scope<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>Construct</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> <span class=\"token string\">'FrontendStack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>All files, which our static content consists of, will be stored on S3, so we need to create a bucket there:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> <span class=\"token string\">'FrontendStack'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> frontBucket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">s3<span class=\"token punctuation\">.</span>Bucket</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'FrontendBucket'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  websiteIndexDocument<span class=\"token operator\">:</span> <span class=\"token string\">'index.html'</span><span class=\"token punctuation\">,</span>\n  publicReadAccess<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Next, we need to tell <code class=\"language-text\">@aws-cdk/aws-s3-deployment</code> to push contents of <code class=\"language-text\">frontent/build</code> to the bucket created above:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">s3deploy<span class=\"token punctuation\">.</span>BucketDeployment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DeployWebsite'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  sources<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>s3deploy<span class=\"token punctuation\">.</span>Source<span class=\"token punctuation\">.</span><span class=\"token function\">asset</span><span class=\"token punctuation\">(</span>\n    path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'frontend'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  destinationBucket<span class=\"token operator\">:</span> frontBucket\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Since our aws-cdk stack uses assets we need to bootstrap our AWS account before <strong>first</strong> deployment:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token builtin class-name\">cd</span> infrastructure\n<span class=\"token assign-left variable\">AWS_PROFILE</span><span class=\"token operator\">=</span>my-profile-name npx cdk bootstrap</code></pre></div>\n<p>Once the above command completes we can now finally deploy our website:</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\"><span class=\"token builtin class-name\">cd</span> infrastructure\n<span class=\"token assign-left variable\">AWS_PROFILE</span><span class=\"token operator\">=</span>my-profile-name <span class=\"token function\">npm</span> run cdk deploy </code></pre></div>\n<p>The command will prompt for confirmation before it creates the necessary security rules.\nYou will see what resources get created or modified while the command runs.\nAfterwards all resources created are part of AWS CloudFormation <code class=\"language-text\">FrontendStack</code> stack.\nMost importantly the command copied all files to S3 Bucket, which in turn can host the website.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5d2071c2f494ad61978f230e6640431c/3707e/s3-contents.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVQ4y41S227TUBD0Z1NaXngDtYBAEAVUKF/CE4I3kNqSNGnsNCSO49iJ77fEGXZO7MqYtuLI4z2298zM7lqbzkwY4zFGhoEx42gE3dBxNbwWjHAzmUDXdQyGAywdF3GSIIpCRHGMOE2RtKB5fgB3tcJ5f4hHrz7g8O0ZDo47ePa+i5PTLg5OOnj85iMO333G0csujl6fqv3TzhnMhY08z4U8UUKElohaKnAdB+e9Pi6uBvhx2Ud/cInh8ELte/oNesYEvWsDvdEYv+S5LwjCCGmW/e1w7sUwBW6UYRkVcOMCu90OkGu7ldsDqyxLydmibEA7/rbAi+82Pv108OTLDM+/WrCCFGWRwU83mIcFsk2pRNq4a2lplqsGJ2mm7LfB91nWgvSN5QXhfjh8TqtvWhRFmM1mCIIARVGol6kkN9GeJA/7km8tFlh7HnKeq0g1TmklU/Z9H7GokZT9u6vEJjabjcplrE1wrxVyo5ojUyYxBbgeIuOiuL1cYr1eYynRsiyE0gKNKiQyTXPvrpreQyApW2Xb9r+EdckL6QeTmHwfSf2NMZGf2HVd1XuSskKerwj3Kky6b7XLrgnZ+1XlUhGyTE8m9Xs6VT2hbaoyNvf8gZsOw0bJjPP5XOVqHHlTgYoU8CQywa9iTXg7FHHo1A6lZbcO88oh7XNy/1MyqpJJRDFG9pDn/wDezHVJT7/8twAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/5d2071c2f494ad61978f230e6640431c/8ac56/s3-contents.webp 240w,\n/static/5d2071c2f494ad61978f230e6640431c/d3be9/s3-contents.webp 480w,\n/static/5d2071c2f494ad61978f230e6640431c/e46b2/s3-contents.webp 960w,\n/static/5d2071c2f494ad61978f230e6640431c/f992d/s3-contents.webp 1440w,\n/static/5d2071c2f494ad61978f230e6640431c/6c20f/s3-contents.webp 1878w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/5d2071c2f494ad61978f230e6640431c/8ff5a/s3-contents.png 240w,\n/static/5d2071c2f494ad61978f230e6640431c/e85cb/s3-contents.png 480w,\n/static/5d2071c2f494ad61978f230e6640431c/d9199/s3-contents.png 960w,\n/static/5d2071c2f494ad61978f230e6640431c/07a9c/s3-contents.png 1440w,\n/static/5d2071c2f494ad61978f230e6640431c/3707e/s3-contents.png 1878w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/5d2071c2f494ad61978f230e6640431c/d9199/s3-contents.png\"\n          alt=\"s3 bucket contents\"\n          title=\"s3 bucket contents\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>One you find the S3 bucket created in the AWS CloudFormation stack:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2c5687577f9d8e771102d31cda02673b/eb1d2/cloudformation-stack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC7UlEQVQ4y3VUi3KcMAzk/3+sz6RN75qmuWeOHBwcBpunwcB25ZBMJjNlRoNtZGm1KxHE8QXb7Q6XSwJrewzDgL7v32x4Z/878+vlXqCNQVFolFWFztqXD7RhsbfgH8/e+fXLmayDqq6hTQl5N21LlBaWH2X9muA1SNdZWufXr34t9369WJDnOaRscXK8WDNwy2ARzzKVc92haRofvKpqn3iaJp9E/LJMoSdV0zh5n0CcrlnmL74+kmm/2+F4OEASal1gZhBBp5Ty/kKTmxzO+oSiVcjqFG5kyYblhs9nnKMIMYXRdByY7Zga7BOD2jp0buLl2aOqyLXw3TQtxmlE09f0J6eOKOcJQRTF+LVa4/7+Aav1PcJTCOtmfA9LfDpqbK8NVEPOxtkHyxZ0dSWBBo8wbzJc62RBWJZ4JsJwMSmpJ6KHpMYqKnmhI5KZNuHjM88zgziPVEz2wfHphK/fbrAmutX6Nw7kzTLgTWjwhQgPqkVaUc1h8iIkaeo5FBGEw2f9BN3mrOLq94Ei6WH47NWTC76f6BybHpeyR1oPb4gmIhWFxQSNmCCT0sU8hyLGze0P3P648+/HzZbZR9SkojQaBRNKUufcm8p+PziPKK0u6IbWizMxeJAkKTabHR4fN9hwBGVyhK2WTdywlSr2YEn0AwPOC0rHCuaFQ9NxyqzhuyBaliyNudsfcD5HuLKRdU5RTIHdz1v8+foZW77V8QCXZ2guEc5/7hFtHqHi2LeKcGeHjhw3LwiFN8VAMmqz7TBphaE0OJ1jhDTLMtnVLw2/lGyJeC41RpMjqxKURCnCiOKBTEhRFMi1Qbbfoq9KiAyr1GKVWJx0z5JGH1BGq+Ag5DRJMRmFS7aHYcnSi15lIVprDZkYw8BdEsEWCn8fNnj4u0OSG/8DEA6d/CAKVqM4qizfVWzwoV5UXiYlvV75E1Aoqao0uYghKPfrFQ604+oO2WGHPuMkFBnK9IIiPsPkBfrxZZZVffVqS+B/948V50funOAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/2c5687577f9d8e771102d31cda02673b/8ac56/cloudformation-stack.webp 240w,\n/static/2c5687577f9d8e771102d31cda02673b/d3be9/cloudformation-stack.webp 480w,\n/static/2c5687577f9d8e771102d31cda02673b/e46b2/cloudformation-stack.webp 960w,\n/static/2c5687577f9d8e771102d31cda02673b/f992d/cloudformation-stack.webp 1440w,\n/static/2c5687577f9d8e771102d31cda02673b/b3a72/cloudformation-stack.webp 1622w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/2c5687577f9d8e771102d31cda02673b/8ff5a/cloudformation-stack.png 240w,\n/static/2c5687577f9d8e771102d31cda02673b/e85cb/cloudformation-stack.png 480w,\n/static/2c5687577f9d8e771102d31cda02673b/d9199/cloudformation-stack.png 960w,\n/static/2c5687577f9d8e771102d31cda02673b/07a9c/cloudformation-stack.png 1440w,\n/static/2c5687577f9d8e771102d31cda02673b/eb1d2/cloudformation-stack.png 1622w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/2c5687577f9d8e771102d31cda02673b/d9199/cloudformation-stack.png\"\n          alt=\"cloudformation stack\"\n          title=\"cloudformation stack\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>Your website is now available under a URL similar to:</p>\n<p><code class=\"language-text\">http://frontendstack-frontendbucketefe2e19c-ixsoxq891rl1.s3-website.eu-central-1.amazonaws.com/</code></p>\n<h2 id=\"improve-performance-of-static-website-with-cloudfront\" style=\"position:relative;\"><a href=\"#improve-performance-of-static-website-with-cloudfront\" aria-label=\"improve performance of static website with cloudfront permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Improve performance of static website with CloudFront</h2>\n<p>The website loads files directly from S3 bucket. The S3 bucket, by default, lives inside a single AWS Region,\nwhich means that visitors from far away may suffer from subpar loading speeds. </p>\n<p>For production setup we can use AWS CloudFront CDN, which distributes our content across over 100 locations around the globe.\nUsing this solution with <code class=\"language-text\">@aws-cdk/aws-s3-deployment</code> is a piece of cake:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> distribution <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cloudfront<span class=\"token punctuation\">.</span>CloudFrontWebDistribution</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Distribution'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  originConfigs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n    s3OriginSource<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      s3BucketSource<span class=\"token operator\">:</span> frontBucket\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    behaviors <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span>isDefaultBehavior<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">cdk<span class=\"token punctuation\">.</span>CfnOutput</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DistributionDomainName'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  value<span class=\"token operator\">:</span> distribution<span class=\"token punctuation\">.</span>domainName\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">s3deploy<span class=\"token punctuation\">.</span>BucketDeployment</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DeployWebsite'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  sources<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>s3deploy<span class=\"token punctuation\">.</span>Source<span class=\"token punctuation\">.</span><span class=\"token function\">asset</span><span class=\"token punctuation\">(</span>\n      path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'..'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'frontend'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'build'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  destinationBucket<span class=\"token operator\">:</span> frontBucket<span class=\"token punctuation\">,</span>\n  distribution<span class=\"token operator\">:</span> distribution<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After you update the stack with <code class=\"language-text\">AWS_PROFILE=my-profile-name npm run cdk deploy</code> you will find a new CloudFront distribution created.\nNote that it make take few minutes to complete.\nWe added <code class=\"language-text\">CfnOutput</code> to make it easier to find the CloudFront distribution autogenerated domain name.</p>\n<div class=\"gatsby-highlight\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\">Outputs:\nFrontendStack.DistributionDomainName = d3a9wcc4fxw2d.cloudfront.net</code></pre></div>\n<p>Now the static website uses global content delivery network! </p>\n<p>You can find full example used in this post <a href=\"https://github.com/miensol/miensol.github.io/tree/develop/content/posts/fast-static-website-with-aws-cdk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">in the Github repository</a></p>","fields":{"slug":"/fast-static-website-with-aws-cdk/","tagSlugs":["/tag/aws/","/tag/cloud-formation/","/tag/aws-cdk/","/tag/website/","/tag/infrastructure-as-code/","/tag/cloud-front/"]},"excerpt":"In this post we’ll see how to create and deploy a static website using IaC using the following technologies: aws-cdk AWS CloudFormation AWS Lambda AWS S3 Have a static website For the sake of simplicity we’ll use Create React App in a directory called : Create the static website content inside  directory with: Add aws…","frontmatter":{"date":"2020-05-03T00:00:00.000Z","description":null,"tags":["aws","CloudFormation","aws-cdk","website","infrastructure as code","CloudFront"],"title":"Deploy fast, static website to AWS like a pro","socialImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAgAB/9oADAMBAAIQAxAAAAHiNfIWIsbf/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIDERIAEP/aAAgBAQABBQJRbFK8gfImlUtpO//EABYRAQEBAAAAAAAAAAAAAAAAAAARAf/aAAgBAwEBPwG4r//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAECAQE/Aaf/xAAcEAABAwUAAAAAAAAAAAAAAAAAASExAxARInH/2gAIAQEABj8CHTFoQ2pv0g//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMUFhgZH/2gAIAQEAAT8hXBOsR9NcyqmMOUdTu5MEm/s//9oADAMBAAIAAwAAABA83//EABYRAQEBAAAAAAAAAAAAAAAAAAEAEf/aAAgBAwEBPxAIxLF//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxBE8sb/xAAcEAEBAQACAwEAAAAAAAAAAAABEQAhQTFRYbH/2gAIAQEAAT8QRFXwwqDyThrAOjHADZULzZff3Jk3oq/uYsc//9k=","aspectRatio":1.3333333333333333,"src":"/static/b26fab00cdfefd007568b3fd0850f29f/a6352/speed.jpg","srcSet":"/static/b26fab00cdfefd007568b3fd0850f29f/40426/speed.jpg 240w,\n/static/b26fab00cdfefd007568b3fd0850f29f/9104c/speed.jpg 480w,\n/static/b26fab00cdfefd007568b3fd0850f29f/a6352/speed.jpg 960w,\n/static/b26fab00cdfefd007568b3fd0850f29f/7f945/speed.jpg 1440w,\n/static/b26fab00cdfefd007568b3fd0850f29f/d8255/speed.jpg 1920w,\n/static/b26fab00cdfefd007568b3fd0850f29f/347e9/speed.jpg 4608w","sizes":"(max-width: 960px) 100vw, 960px"}}}}}},"pageContext":{"slug":"/fast-static-website-with-aws-cdk/"}}}