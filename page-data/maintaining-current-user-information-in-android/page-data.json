{"componentChunkName":"component---src-templates-post-template-tsx","path":"/maintaining-current-user-information-in-android/","result":{"data":{"markdownRemark":{"id":"c62da40b-9fa7-5dae-84fa-b784cedb794e","html":"<p>Every but trivial android application needs to maintain information about current user - regardless if he has authenticated or not. While this may sound easy there are still at least handful of ways one can do it - in this article I’m going to explore couple of them.</p>\n<h2 id=\"keeping-state-in-custom-application-class\" style=\"position:relative;\"><a href=\"#keeping-state-in-custom-application-class\" aria-label=\"keeping state in custom application class permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keeping state in custom <code class=\"language-text\">Application</code> class</h2>\n<p>This technique boils down to having custom application class like so:</p>\n<script src=\"https://gist.github.com/miensol/e7fcce936e0acb3499ec.js?file=MyApplication.java\"></script>\n<p>While the above is both easy to write and understand there are several problems with it. First and foremost if you would like to get some user property you’ll need to reference <code class=\"language-text\">MyApplication</code> i.e.:</p>\n<script src=\"https://gist.github.com/miensol/e7fcce936e0acb3499ec.js?file=ActionBar.java\"></script>\n<p>Since data about current user will be used in several places spread through the code each of those places will now be coupled to <code class=\"language-text\">MyApplication</code>. This on the other hand will jeopardize any attempt to break the code base into modules. Furthermore this approach may encourage sharing other global application state through static variables defined on custom <code class=\"language-text\">Application</code> class. In short <strong>don’t do this</strong>.</p>\n<h2 id=\"keeping-global-state-in-user-class\" style=\"position:relative;\"><a href=\"#keeping-global-state-in-user-class\" aria-label=\"keeping global state in user class permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keeping global state in <code class=\"language-text\">User</code> class</h2>\n<p>A slightly better idea is to move static variables from <code class=\"language-text\">Application</code> class into <code class=\"language-text\">User</code> class itself:</p>\n<script src=\"https://gist.github.com/miensol/e7fcce936e0acb3499ec.js?file=User.java\"></script>\n<p>Now our <code class=\"language-text\">Application</code> class has one less responsibility and we don’t need smelly references spread around the codebase. We may also be able to split the project into modules - as long as we’re not too inclined to separating concerns. Problems arise as soon as you start unit testing though. Remember that good unit test should be as isolated as possible. Using global state through static methods on <code class=\"language-text\">User</code> class forces us to properly <code class=\"language-text\">setUp()</code> and <code class=\"language-text\">tearDown()</code> its state in every test. It would be much easier if we could properly inject information about current user through tested component(s) constructor(s).</p>\n<p>I mentioned <a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">separation of concerns</a> - does a user class have any reason to know whether a user has signed in? I don’t think so.</p>\n<h2 id=\"separating-concerns-with-user-session\" style=\"position:relative;\"><a href=\"#separating-concerns-with-user-session\" aria-label=\"separating concerns with user session permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Separating concerns with User Session</h2>\n<p>I find it helpful to think about objects lifetimes when designing components. In every application that allows users to sign in there will be a time where we don’t have a <em>user object</em> to work with. To express that property I usually store the information about current user in a <em>Session</em> object. There is only one <em>user</em> session whenever an application is running. After user signs in the session is updated to represent it. After signing out it’s usually a good idea to reset session state. Consider following example:</p>\n<script src=\"https://gist.github.com/miensol/e7fcce936e0acb3499ec.js?file=Session.java\"></script>\n<p>Couple of things to note here. First and foremost the <code class=\"language-text\">Session</code> class <strong>is not public</strong> it’s local to package responsible for maintaining it’s state. Typically it’s a package dealing with user registration, sign in and keeping remote services auth tokens fresh. Secondly <code class=\"language-text\">Session</code> public interface only covers methods defined in <code class=\"language-text\">CurrentUserInfo</code> exposing methods that come handy when getting current user name. The <code class=\"language-text\">Session</code> object is not limited to one interface. Quite opposite it may implement more interfaces depending on different <em>clients</em> (components requesting various details about current user) needs.</p>\n<p>Since <code class=\"language-text\">Session</code> embraces <a href=\"https://en.wikipedia.org/wiki/Interface_segregation_principle\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Interface Segregation Principle</a> it’s much easier to test code that requests information about current user i.e <code class=\"language-text\">AppBeahvior</code>. A reusable <a href=\"http://www.martinfowler.com/bliki/TestDouble.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">fake</a> can be coded with no effort - it only has to implement very limited set of methods.</p>\n<p>Notice that I’ve not used static methods nor variables in above example. Instead I’ve simply marked the class with <code class=\"language-text\">@Singleton</code> annotation to ensure that there will only be single instance ever created, injected and used. I highly encourage using Dependency Injection frameworks (a.k.a IoC containers) with <a href=\"http://square.github.io/dagger/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dagger</a> (and <a href=\"http://google.github.io/dagger/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dagger 2</a>) taking the lead in Android space.</p>\n<p>In the next article I’m going to show a way to deal with application behavior changing depending on user being logged in or not.</p>\n<p><em>This article is cross-posted with <a href=\"http://blog.brightinventions.pl\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">my company blog</a></em></p>","fields":{"slug":"/maintaining-current-user-information-in-android/","tagSlugs":["/tag/android/"]},"excerpt":"Every but trivial android application needs to maintain information about current user - regardless if he has authenticated or not. While this may sound easy there are still at least handful of ways one can do it - in this article I’m going to explore couple of them. Keeping state in custom  class This technique boils…","frontmatter":{"date":"2015-06-30T00:00:00.000Z","description":null,"tags":["android"],"title":"Maintaining current user information in Android","socialImage":null}}},"pageContext":{"slug":"/maintaining-current-user-information-in-android/"}}}