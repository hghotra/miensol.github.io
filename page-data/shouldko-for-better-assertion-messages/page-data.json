{"componentChunkName":"component---src-templates-post-template-tsx","path":"/shouldko-for-better-assertion-messages/","result":{"data":{"markdownRemark":{"id":"56bb9580-7280-587d-a477-443385e08898","html":"<p>Most of us write tests these days. Whether they are unit, integration, end-to-end or performance tests once written we often do not go back to them until they fail. It is thus vital to have a clear assertion message when a test fails.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/485a23c6db6fa5273fbf6fd1bee9ad06/c08c5/search.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB92E85rcCsLAf/8QAGxABAAICAwAAAAAAAAAAAAAAAQIQABESISP/2gAIAQEAAQUCXRCfKpGyJ60Hef/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAEFAAAAAAAAAAAAAAAAAAABEBEgYf/aAAgBAQAGPwJ4Fyv/xAAaEAEAAwEBAQAAAAAAAAAAAAABABARQSEx/9oACAEBAAE/Idh7CLWvrN7MwPCjBEn1r//aAAwDAQACAAMAAAAQoMc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAAICAwEAAAAAAAAAAAAAAREhABAxQVHh/9oACAEBAAE/EIsuFHuMElMB3onlBEOTDWFgA9PuuGD09mv/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/485a23c6db6fa5273fbf6fd1bee9ad06/8ac56/search.webp 240w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/d3be9/search.webp 480w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/0ba47/search.webp 640w\"\n          sizes=\"(max-width: 640px) 100vw, 640px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/485a23c6db6fa5273fbf6fd1bee9ad06/09b79/search.jpg 240w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/7cc5e/search.jpg 480w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/c08c5/search.jpg 640w\"\n          sizes=\"(max-width: 640px) 100vw, 640px\"\n          type=\"image/jpeg\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/485a23c6db6fa5273fbf6fd1bee9ad06/c08c5/search.jpg\"\n          alt=\"search\"\n          title=\"search\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<h2 id=\"hamcrest\" style=\"position:relative;\"><a href=\"#hamcrest\" aria-label=\"hamcrest permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hamcrest</h2>\n<p>I think <a href=\"http://hamcrest.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hamcrest</a> is the most popular assertion library available in Java and Kotlin ecosystem. Let us look at an oversimplified example of <a href=\"https://martinfowler.com/bliki/ValueObject.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Money</code></a> class:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>math<span class=\"token punctuation\">.</span>BigDecimal\n<span class=\"token keyword\">import</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>\n\n<span class=\"token keyword\">data</span> <span class=\"token keyword\">class</span> <span class=\"token function\">Money</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">val</span> amount<span class=\"token operator\">:</span> BigDecimal<span class=\"token punctuation\">,</span> <span class=\"token keyword\">val</span> currency<span class=\"token operator\">:</span> Currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">operator</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">plus</span><span class=\"token punctuation\">(</span>other<span class=\"token operator\">:</span> Money<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Money <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>currency <span class=\"token operator\">!=</span> other<span class=\"token punctuation\">.</span>currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token function\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Cannot add <span class=\"token interpolation variable\">$this</span> to <span class=\"token interpolation variable\">$other</span>. Currencies must match.\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token comment\">// an accidentally introduced bug ðŸ˜ˆ</span>\n        <span class=\"token keyword\">val</span> newAmount <span class=\"token operator\">=</span> amount <span class=\"token operator\">+</span> other<span class=\"token punctuation\">.</span>amount <span class=\"token operator\">+</span> <span class=\"token number\">10.0</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">copy</span><span class=\"token punctuation\">(</span>amount <span class=\"token operator\">=</span> newAmount<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Imagine we write a test for the <a href=\"https://kotlinlang.org/docs/reference/operator-overloading.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">plus</code></a> operator using <a href=\"http://junit.org/junit5/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JUnit</a> and <a href=\"http://hamcrest.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hamcrest</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">class MoneyTests {\n    val usd = Currency.getInstance(&quot;USD&quot;)\n\n    @Test\n    fun can_add() {\n        val usd100 = Money(100.toBigDecimal(), usd)\n        val usd50 = Money(50.toBigDecimal(), usd)\n\n        assertThat((usd100 + usd50).amount, equalTo(150.toBigDecimal()))\n    }\n}</code></pre></div>\n<p>The test will fail with the following message:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">java.lang.AssertionError: \nExpected: &lt;150&gt;\n     but: was &lt;160&gt;</code></pre></div>\n<p>Letâ€™s see how we can improve on that.</p>\n<h2 id=\"shouldko-better-assertion-messages-for-kotlin\" style=\"position:relative;\"><a href=\"#shouldko-better-assertion-messages-for-kotlin\" aria-label=\"shouldko better assertion messages for kotlin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ShouldKO: better assertion messages for Kotlin</h2>\n<p><a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKO</a> is a simple library Iâ€™ve come up with that improves the assertion messages. Its idea is based on assertion libraries available in .NET e.g. <a href=\"https://github.com/shouldly/shouldly\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Shouldly</a>. Let us see how the tests looks like using <a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKO</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">class</span> MoneyTests <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> usd <span class=\"token operator\">=</span> Currency<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"USD\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token annotation builtin\">@Test</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">can_add</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">val</span> usd100 <span class=\"token operator\">=</span> <span class=\"token function\">Money</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> usd<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">val</span> usd50 <span class=\"token operator\">=</span> <span class=\"token function\">Money</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> usd<span class=\"token punctuation\">)</span>\n\n        <span class=\"token punctuation\">(</span>usd100 <span class=\"token operator\">+</span> usd50<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">shouldEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">150</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBigDecimal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In my opinion <a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKOâ€™s</a> assertion syntax improves readability. However, this is not where <a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKO</a> main improvement is. Follow the improved assertion message:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">java.lang.AssertionError: (usd100 + usd50).amount \nExpected: &lt;150&gt;\n     but: was &lt;160&gt;</code></pre></div>\n<p><a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKO</a> incorporates a source code line with the assertion into the assertion message itself. This comes really handy when we have multiple lines with assertions that form one logical condition. This is a small thing, but can greatly improve debugging test issues especially when all we have is a log file produced by a test run.</p>\n<h2 id=\"installation-of-shouldko\" style=\"position:relative;\"><a href=\"#installation-of-shouldko\" aria-label=\"installation of shouldko permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation of ShouldKO</h2>\n<p><a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKO</a> is currently available on <a href=\"https://jitpack.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Jitpack</a>. You need to first add Jitpack to your repositories:</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">repositories <span class=\"token punctuation\">{</span>\n    maven <span class=\"token punctuation\">{</span> url <span class=\"token string\">'https://jitpack.io'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">mavenCentral</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And include the library in your tests e.g.:</p>\n<div class=\"gatsby-highlight\" data-language=\"groovy\"><pre class=\"language-groovy\"><code class=\"language-groovy\">testImplementation <span class=\"token string\">'com.github.miensol.shouldko:hamcrest:v0.1.0'</span></code></pre></div>\n<p><a href=\"https://github.com/miensol/shouldko\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ShouldKOâ€™s</a> Hamcrest library allows for using any Hamcrest matcher.</p>","fields":{"slug":"/shouldko-for-better-assertion-messages/","tagSlugs":["/tag/junit/","/tag/hamcreset/","/tag/kotlin/","/tag/assertion/","/tag/tests/"]},"excerpt":"Most of us write tests these days. Whether they are unit, integration, end-to-end or performance tests once written we often do not go back to them until they fail. It is thus vital to have a clear assertion message when a test fails.  Hamcrest I think Hamcrest is the most popular assertion library available in Javaâ€¦","frontmatter":{"date":"2018-01-17T00:00:00.000Z","description":null,"tags":["junit","hamcreset","kotlin","assertion","tests"],"title":"Use ShouldKO for better assertion messages","socialImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAIDBAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB92E85rcCsLAf/8QAGxABAAICAwAAAAAAAAAAAAAAAQIQABESISP/2gAIAQEAAQUCXRCfKpGyJ60Hef/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAEFAAAAAAAAAAAAAAAAAAABEBEgYf/aAAgBAQAGPwJ4Fyv/xAAaEAEAAwEBAQAAAAAAAAAAAAABABARQSEx/9oACAEBAAE/Idh7CLWvrN7MwPCjBEn1r//aAAwDAQACAAMAAAAQoMc8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHBABAAICAwEAAAAAAAAAAAAAAREhABAxQVHh/9oACAEBAAE/EIsuFHuMElMB3onlBEOTDWFgA9PuuGD09mv/2Q==","aspectRatio":1,"src":"/static/485a23c6db6fa5273fbf6fd1bee9ad06/f422e/search.jpg","srcSet":"/static/485a23c6db6fa5273fbf6fd1bee9ad06/40426/search.jpg 240w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/9104c/search.jpg 480w,\n/static/485a23c6db6fa5273fbf6fd1bee9ad06/f422e/search.jpg 640w","sizes":"(max-width: 640px) 100vw, 640px"}}}}}},"pageContext":{"slug":"/shouldko-for-better-assertion-messages/"}}}